services:

  ignition:
    image: inductiveautomation/ignition:8.1
    container_name: hydramqtt_ignition
    hostname: ignition
    restart: unless-stopped
#    networks:
#      - rtmd-network
    ports:
      - '8088:8088'
    command: >
      -n Hydra-MQTT
    environment:
      - DISABLE_QUICKSTART=true
      - GATEWAY_ADMIN_USERNAME=admin
      - GATEWAY_ADMIN_PASSWORD=password
      - IGNITION_EDITION=standard
      - TZ=America/New_York
      - GATEWAY_MODULES_ENABLED=all
    volumes:
#      - hydramqtt_ignition_data:/usr/local/bin/ignition/data
      - ./ignition/secrets/ca.crt:/run/secrets/ca.crt:ro
      - ./ignition/secrets/client.crt:/run/secrets/client.crt:ro
      - ./ignition/secrets/client.key:/run/secrets/client.key:ro
      - ./ignition/secrets/password_file:/run/secrets/password_file:ro

  broker:
    image: emqx/emqx
    container_name: hydramqtt_broker
    hostname: broker
    restart: unless-stopped
#    networks:
#      - rtmd-network
    ports:
#      - '1883:1883'
      - '8883:8883'
      - '18083:18083'
    environment:
      - EMQX_DASHBOARD__DEFAULT_USERNAME=admin
      - EMQX_DASHBOARD__DEFAULT_PASSWORD=password
    volumes:
      - ./emqx/emqx.conf:/opt/emqx/etc/emqx.conf:ro
      - ./emqx/acl.conf:/opt/emqx/etc/acl.conf:ro
      - ./emqx/secrets/ca.crt:/run/secrets/ca.crt:ro
      - ./emqx/secrets/init_user_hash.json:/opt/init_user_hash.json:ro
      - ./emqx/secrets/server.crt:/run/secrets/server.crt:ro
      - ./emqx/secrets/server.key:/run/secrets/server.key:ro

#volumes:
#  hydramqtt_ignition_data:
#    name: 'hydramqtt_ignition_data'

#networks:
#  rtmd-network:
#    name: 'rtmd-network'
